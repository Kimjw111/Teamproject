<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/loading.css" />
    <link rel="stylesheet" href="/chat_home.css" />
  </head>
  <body>
    <!-- 로딩화면 -->
    <div id="real_all" style="display: block">
      <div id="All">
        <img id="loading_whale" src="/Whale.jpg" alt="고래" />
        <p id="up">Whale-chat</p>
        <p id="sub">Now loading</p>
        <div id="loading_cl">
          <div id="cl01"></div>
          <div id="cl02"></div>
          <div id="cl03"></div>
          <div id="cl04"></div>
        </div>
      </div>
    </div>
    <!-- // 로딩화면 -->

    <!-- 쳇홈화면 -->
    <div id="Nt">
      <div id="container">
        <div id="header">
          <img src="/Whale.jpg" alt="whale" width="100px" height="100px" />
          <div id="head">
            <h1 id="title">Whale-chat</h1>
          </div>
          <!-- 인원수자리 -->
          <!-- <div id="person">
            <span></span>
          </div> -->
        </div>
        <div id="chat">
          <ul id="messages"></ul>
        </div>
        <form id="message-form">
          <input id="input" autocomplete="off" />
          <button id="send_btn">전송</button>
        </form>
      </div>
    </div>
    <!-- //쳇홈화면 -->

    <!-- 스크립트 -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const data = new Date();
      setTimeout(() => {
        const nt = document.getElementById("Nt");
        const all = document.getElementById("real_all");
        nt.style.display = "block";
        all.style.display = "none";
      }, 2.9 * 1000);
      setTimeout(() => {
        const socket = io();

        // 로그인
        const username = prompt("대화명을 입력하세요 (익명 또는 원하는 이름)");
        socket.emit("login", username);

        // 채팅 메시지 전송
        document
          .getElementById("message-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();
            const input = document.getElementById("input");
            const message = input.value;
            input.value = "";
            socket.emit("chat message", { message: message });
          });

        // 채팅 메시지 받기
        socket.on("chat message", (msg) => {
          const messages = document.getElementById("messages");
          const nickname = document.createElement("li");
          const item = document.createElement("li");
          nickname.style.fontSize = "0.8rem";
          nickname.textContent = `★${msg.from}★`;
          item.textContent = ` ${msg.message}`;
          messages.append(nickname, item);
          // 스크롤 자동 아래로 이동 요청
          socket.emit("scroll");
          // window.scrollTo(0, document.body.scrollHeight);
        });
        socket.on("scroll to bottom", () => {
          const chat = document.getElementById("chat");
          chat.scrollTop = chat.scrollHeight;
        });
      }, 3000);
    </script>
  </body>
</html>
